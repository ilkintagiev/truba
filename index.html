<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>InvestTruba – Продажа труб</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 text-gray-900 font-sans">
  <header class="bg-gray-900 text-white py-6 text-center">
    <h1 class="text-3xl font-bold">InvestTruba</h1>
    <p class="mt-2 text-lg">Продажа труб по выгодным ценам</p>
  </header>

  <main class="max-w-7xl mx-auto px-4 py-8">
    <div id="product-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>

    <div class="admin-section bg-white p-6 mt-8 rounded-xl shadow-lg">
      <h3 class="text-xl font-semibold mb-4">Админ-панель</h3>
      <div class="flex flex-col sm:flex-row gap-4">
        <input type="password" id="admin-password" placeholder="Введите пароль" class="border rounded-lg p-2 flex-1" />
        <button class="btn bg-blue-600 text-white rounded-lg px-4 py-2 hover:bg-blue-700 transition" onclick="loginAdmin()">Войти</button>
      </div>

      <div id="admin-panel" class="mt-6 hidden">
        <h4 class="text-lg font-semibold mb-2">Добавить новую трубу</h4>
        <form id="add-product-form" onsubmit="addProduct(event)" class="space-y-4">
          <input id="new-title" placeholder="Название" required class="w-full border rounded-lg p-2" />
          <input id="new-img" placeholder="URL изображения" required type="url" class="w-full border rounded-lg p-2" />
          <input id="new-diam" placeholder="Диаметр" required class="w-full border rounded-lg p-2" />
          <input id="new-price" placeholder="Цена" required type="text" pattern="\d+\s*₽/т" class="w-full border rounded-lg p-2" />
          <textarea id="new-desc" placeholder="Описание" required class="w-full border rounded-lg p-2 h-32"></textarea>
          <button type="submit" class="btn bg-blue-600 text-white rounded-lg px-4 py-2 hover:bg-blue-700 transition">Добавить</button>
        </form>

        <h4 class="text-lg font-semibold mt-6 mb-2">Список заявок</h4>
        <pre id="orders" class="bg-gray-50 p-4 rounded-lg"></pre>
      </div>
    </div>
  </main>

  <footer class="text-center py-6 text-gray-500">
    © 2025 InvestTruba
  </footer>

  <script>
    let products = JSON.parse(localStorage.getItem("products")) || [
      {
        title: "Труба 159мм, сталь 20",
        image: "https://loremflickr.com/320/240/steel",
        diameter: "159мм",
        price: "55 000 ₽/т",
        desc: "Подходит для газовых и водопроводных систем."
      },
      {
        title: "Труба 273мм, бесшовная",
        image: "https://loremflickr.com/321/241/pipe",
        diameter: "273мм",
        price: "65 000 ₽/т",
        desc: "Высокая прочность, идеальна для нефтяной отрасли."
      }
    ];

    let orders = JSON.parse(localStorage.getItem("orders")) || [];

    function saveData() {
      localStorage.setItem("products", JSON.stringify(products));
      localStorage.setItem("orders", JSON.stringify(orders));
    }

    function renderProducts() {
      const list = document.getElementById("product-list");
      list.innerHTML = "";
      products.forEach((p, i) => {
        list.innerHTML += `
          <div class="product bg-white rounded-xl shadow-lg p-6">
            <h3 class="text-xl font-semibold">${p.title}</h3>
            <img src="${p.image}" alt="${p.title}" class="w-full h-48 object-cover rounded-lg mt-4" />
            <p class="mt-2"><b>Диаметр:</b> ${p.diameter}</p>
            <p><b>Цена:</b> ${p.price}</p>
            <p class="text-gray-600">${p.desc}</p>
            <button class="btn bg-blue-600 text-white rounded-lg px-4 py-2 mt-4 hover:bg-blue-700 transition" onclick="showForm(${i})">Оформить заявку</button>
            <button class="btn bg-red-600 text-white rounded-lg px-4 py-2 mt-2 hover:bg-red-700 transition hidden admin-only" onclick="deleteProduct(${i})">Удалить</button>
            <form id="form-${i}" class="form mt-4 hidden space-y-4" onsubmit="sendOrder(event, ${i})">
              <input placeholder="Ваше имя" id="name-${i}" required class="w-full border rounded-lg p-2" />
              <input placeholder="Телефон" id="phone-${i}" required type="tel" pattern="\+?\d{10,}" class="w-full border rounded-lg p-2" />
              <textarea placeholder="Комментарий" id="comment-${i}" class="w-full border rounded-lg p-2 h-24"></textarea>
              <button type="submit" class="btn bg-blue-600 text-white rounded-lg px-4 py-2 hover:bg-blue-700 transition">Отправить</button>
            </form>
          </div>
        `;
      });
      toggleAdminControls();
    }

    function showForm(i) {
      document.getElementById(`form-${i}`).classList.toggle("hidden");
    }

    function sendOrder(event, i) {
      event.preventDefault();
      const name = document.getElementById(`name-${i}`).value;
      const phone = document.getElementById(`phone-${i}`).value;
      const comment = document.getElementById(`comment-${i}`).value;
      orders.push({
        product: products[i].title,
        name, phone, comment,
        date: new Date().toLocaleString("ru-RU")
      });
      saveData();
      alert("Заявка отправлена!");
      document.getElementById(`form-${i}`).reset();
      document.getElementById(`form-${i}`).classList.add("hidden");
      renderOrders();
    }

    function loginAdmin() {
      const pass = document.getElementById("admin-password").value;
      // In production, use proper authentication (e.g., server-side)
      if (pass === "admin123") {
        document.getElementById("admin-panel").classList.remove("hidden");
        document.getElementById("admin-password").value = "";
        renderOrders();
        toggleAdminControls();
      } else {
        alert("Неверный пароль");
      }
    }

    function toggleAdminControls() {
      const isAdmin = !document.getElementById("admin-panel").classList.contains("hidden");
      document.querySelectorAll(".admin-only").forEach(btn => {
        btn.classList.toggle("hidden", !isAdmin);
      });
    }

    function renderOrders() {
      const text = orders.map(o => 
        `${o.date}\n${o.name} (${o.phone}) заказал: ${o.product}\nКомментарий: ${o.comment}\n`
      ).join("\n---\n");
      document.getElementById("orders").textContent = text || "Заявок нет";
    }

    function addProduct(event) {
      event.preventDefault();
      const title = document.getElementById("new-title").value;
      const image = document.getElementById("new-img").value;
      const diameter = document.getElementById("new-diam").value;
      const price = document.getElementById("new-price").value;
      const desc = document.getElementById("new-desc").value;
      products.push({ title, image, diameter, price, desc });
      saveData();
      renderProducts();
      document.getElementById("add-product-form").reset();
      alert("Продукт добавлен!");
    }

    function deleteProduct(i) {
      if (confirm(`Удалить ${products[i].title}?`)) {
        products.splice(i, 1);
        saveData();
        renderProducts();
        alert("Продукт удален!");
      }
    }

    renderProducts();
  </script>
</body>
</html>
